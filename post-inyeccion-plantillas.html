<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="image/x-icon" href="https://ik94g-g2ilo0g24kig24-f4ig4h79g4inuy-p.netlify.app/pfp.jpg" />
  <title>Inyección de Plantillas del Lado del Servidor (SSTI)</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: url('https://images.alphacoders.com/296/thumb-1920-296801.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #333;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background: rgba(255, 250, 246, 0.95);
      z-index: -1;
    }

    .content {
      max-width: 900px;
      margin: 50px auto;
      background: #fff;
      border-radius: 16px;
      padding: 40px 30px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
    }

    h1, h2 {
      font-family: 'Playfair Display', serif;
      color: #2c3e50;
    }

    p {
      line-height: 1.6;
      color: #444;
    }

    ul {
      padding-left: 1.2em;
      margin-bottom: 1.5rem;
    }

    pre {
      background: #272822;
      color: #f8f8f2;
      padding: 1rem;
      overflow-x: auto;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    code {
      color: #c3e88d;
      font-family: monospace;
    }

    .warning, .tip {
      padding: 1rem;
      border-left: 5px solid;
      margin: 1rem 0;
      border-radius: 6px;
    }

    .warning {
      background: #fff4e5;
      border-color: #e17055;
    }

    .tip {
      background: #eafafc;
      border-color: #00cec9;
    }

    .back-button {
      display: inline-block;
      margin-top: 2rem;
      text-decoration: none;
      background-color: #fce6ed;
      color: #c95f86;
      padding: 10px 18px;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .back-button:hover {
      background-color: #c95f86;
      color: #fff;
    }

    footer {
      text-align: center;
      padding: 40px 20px;
      font-size: 0.9em;
      color: #aaa;
    }

    .subtitle {
      margin-top: -1rem;
      margin-bottom: 2rem;
      color: #777;
      font-size: 1.1rem;
      text-align: center;
    }
  </style>
</head>
<body>

<div class="content">
  <h1>Inyección de Plantillas del Lado del Servidor (SSTI)</h1>
  <p class="subtitle">cuando el render te juega en contra</p>

  <p><strong>SSTI</strong> ocurre cuando una aplicación mete valores que vienen del usuario directamente en una plantilla sin controlarlos ni filtrarlos. Eso puede acabar en ejecución remota de código si el motor de plantillas lo permite y el dev no cortó lo que tocaba.</p>

  <h2>¿Dónde empieza la liada?</h2>
  <p>Algo básico:</p>
  <pre><code>Hola {{nombre}}</code></pre>
  <p>Si metes <code>{{7*7}}</code> y te sale <code>Hola 49</code>, hay SSTI. Pero eso es solo el principio.</p>

  <h2>Subiendo de nivel: explorando el entorno</h2>
  <p>En motores como <code>Jinja2</code>, podrías meter cosas como:</p>
  <pre><code>{{ config }}</code></pre>
  <p>O peor:</p>
  <pre><code>{{ self._TemplateReference__context.cycler.__init__.__globals__.os.popen('ls').read() }}</code></pre>
  <p>Y si eso te saca cosas del sistema, ya estamos hablando de <strong>RCE directo</strong>. Ahi la fiesta empieza de verdad.</p>

  <h2>Plantillas: qué hacen y por qué se rompen</h2>
  <p>Una template debería recibir datos ya validados, tipo:</p>
  <pre><code>"Bienvenido {{usuario}}"</code></pre>
  <p>Pero si al final el usuario puede modificar la propia lógica de la plantilla (y no solo el valor), puede colarse lógica, llamadas a funciones, e incluso escapes del sandbox.</p>

  <h2>Motores que han petado feo</h2>
  <ul>
    <li><strong>Jinja2</strong>: sin sandbox, puedes llegar a ejecutar comandos del sistema desde el navegador. Literalmente <code>os.popen()</code> desde un campo de input.</li>
    <li><strong>Twig</strong>: permite acceder a propiedades y funciones internas. Si no tienes cuidado, se filtra info o ejecutas código PHP.</li>
    <li><strong>Handlebars</strong>: si alguien cuela un helper o manipula el prototipo del objeto, puedes llegar a modificar la lógica del render.</li>
    <li><strong>Pug / Jade</strong>: errores en la indentación o uso de mixins pueden derivar en lógica inyectada sin querer.</li>
  </ul>

  <h2>Explotación típica</h2>
  <p>1. Mandas un input con algo que sabes que se ejecuta, tipo <code>{{7*8}}</code>.<br>
     2. Si ves que sale <code>56</code> en vez de lo que escribiste, ya sabes que evalúa.<br>
     3. Buscas objetos accesibles: <code>{{ self }}</code>, <code>{{ config }}</code>, <code>{{ ''.__class__.__mro__ }}</code>...<br>
     4. Intentas llegar a funciones tipo <code>os.system</code> o <code>popen()</code> para ejecutar comandos.</p>

  <h2>Bypasses y evasiones</h2>
  <p>Hay filtros tontos tipo bloquear <code>{</code> o <code>}}</code>, pero los motores suelen permitir notación alternativa:</p>
  <ul>
    <li><code>${7*7}</code></li>
    <li><code><%= 7*7 %></code></li>
    <li>Uso de <code>set</code>, <code>eval</code>, objetos internos, contextos ocultos...</li>
  </ul>

<h2>Prevención real</h2>
<ul>
  <li>Jamás metas datos directos del usuario dentro de la plantilla sin ni siquiera echarles un vistazo.</li>
  <li>Procura usar motores que no permitan que se ejecute código dinámico, así evitas problemas chungos.</li>
  <li>Escapa todo, valida con ojo de halcón lo que entra, no te quedes corto filtrando.</li>
  <li>Si el motor que usas deja, activa un sandbox que limite lo que puede hacer el código.</li>
  <li>Chequea los logs para encontrar patrones raros, como <code>{{</code> o palabras como <code>__class__</code>, que suelen ser señal de ataques.</li>
  <li>Olvídate de funciones peligrosas como <code>eval()</code> o <code>exec()</code> cuando el input viene del usuario, no las uses para nada.</li>
  <li>Restringe bien qué variables y métodos puede acceder la plantilla, no le des acceso a todo el cotarro.</li>
  <li>Con Jinja2, usa <code>autoescape=True</code> y crea un entorno (<code>Environment</code>) con las reglas bien puestas.</li>
  <li>No dejes que los usuarios puedan tirar mano de atributos con doble guión bajo (<code>__*</code>) o métodos sensibles.</li>
  <li>Evita que el usuario decida qué plantilla cargar o la ruta, eso es peligroso y abre puertas a ataques.</li>
  <li>Usa listas blancas para los inputs que terminen en plantillas, controla bien los patrones, algo tipo <code>^[a-zA-Z0-9 ]+$</code> va bien.</li>
  <li>Monta un sistema para vigilar y auditar los puntos donde llegan datos para plantillas, así pillas cualquier cosa rara rápido.</li>
  <li>Haz pruebas tú mismo con payloads locos tipo <code>{{config}}</code>, <code>{{request}}</code> o <code>{{self.__class__}}</code>, para ver si te cuela algo.</li>
  <li>Si hay errores, no muestres información que deje ver la estructura interna ni tracebacks completos, eso da pistas a los malos.</li>
  <li>Piénsate usar análisis estático que te diga dónde el código mete plantillas inseguras.</li>
</ul>
</div>
  
  <a class="back-button" href="index.html">← Volver al blog</a>
</div>

  <footer>
    © 2025 Undefined_name blog
  </footer>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9778679469657985"
     crossorigin="anonymous"></script>
  
</body>
</html>

